<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>宝探しストラテジーゲーム</title>
  <style>
    body {
      font-family: sans-serif;
      background: #222;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    #grid {
      display: grid;
      grid-template-columns: repeat(10, 40px);
      grid-gap: 5px;
      margin-bottom: 20px;
    }
    .cell {
      width: 40px;
      height: 40px;
      background: #444;
      border: 1px solid #666;
      cursor: pointer;
    }
    .player {
      background: blue !important;
    }
    .cpu {
      background: red !important;
    }
    .disabled {
      pointer-events: none;
    }
    #message {
      font-size: 1.2em;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>宝探しゲーム</h1>
  <div id="message">あなたの番です！</div>
  <div id="grid"></div>

  <script>
    const grid = document.getElementById("grid");
    const message = document.getElementById("message");

    const SIZE = 10;
    const TREASURE_COUNT = 3;
    let playerFound = 0;
    let cpuFound = 0;
    let treasures = [];
    let isPlayerTurn = true;
    let cells = [];

    // 初期化
    function init() {
      // グリッド生成
      for (let i = 0; i < SIZE * SIZE; i++) {
        const cell = document.createElement("div");
        cell.classList.add("cell");
        cell.dataset.index = i;
        cell.addEventListener("click", () => handlePlayerTurn(i));
        grid.appendChild(cell);
        cells.push(cell);
      }

      // お宝をランダムに配置
      while (treasures.length < TREASURE_COUNT) {
        const rand = Math.floor(Math.random() * SIZE * SIZE);
        if (!treasures.includes(rand)) treasures.push(rand);
      }
    }

    function handlePlayerTurn(index) {
      if (!isPlayerTurn) return;

      const cell = cells[index];
      if (cell.classList.contains("player") || cell.classList.contains("cpu")) return;

      cell.classList.add("player");
      checkTreasure(index, "player");

      isPlayerTurn = false;
      setTimeout(cpuTurn, 2000);
    }

    function cpuTurn() {
      message.textContent = "CPUの番です...";

      // 選んでないマスを取得
      const available = cells
        .map((cell, i) => ({cell, index: i}))
        .filter(({cell}) => !cell.classList.contains("player") && !cell.classList.contains("cpu"));

      if (available.length === 0) return;

      // 攻め姿勢でランダムに選択
      const {index} = available[Math.floor(Math.random() * available.length)];
      const cell = cells[index];
      cell.classList.add("cpu");
      checkTreasure(index, "cpu");

      setTimeout(() => {
        isPlayerTurn = true;
        message.textContent = "あなたの番です！";
      }, 2000);
    }

    function checkTreasure(index, player) {
      if (treasures.includes(index)) {
        if (player === "player") {
          playerFound++;
          message.textContent = `お宝発見！ あなた: ${playerFound} / 3`;
          if (playerFound === TREASURE_COUNT) {
            endGame("🎉 あなたの勝ち！");
          }
        } else {
          cpuFound++;
          message.textContent = `CPUが宝を見つけた！ CPU: ${cpuFound} / 3`;
          if (cpuFound === TREASURE_COUNT) {
            endGame("😈 CPUの勝ち！");
          }
        }
      }
    }

    function endGame(result) {
      message.textContent = result;
      cells.forEach(cell => cell.classList.add("disabled"));
    }

    init();
  </script>
</body>
</html>
