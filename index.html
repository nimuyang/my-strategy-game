<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>å®æ¢ã—ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ãƒ¼ã‚²ãƒ¼ãƒ </title>
  <style>
    body {
      font-family: sans-serif;
      background: #222;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    #grid {
      display: grid;
      grid-template-columns: repeat(10, 40px);
      grid-gap: 5px;
      margin-bottom: 20px;
    }
    .cell {
      width: 40px;
      height: 40px;
      background: #444;
      border: 1px solid #666;
      cursor: pointer;
    }
    .player {
      background: blue !important;
    }
    .cpu {
      background: red !important;
    }
    .disabled {
      pointer-events: none;
    }
    #message {
      font-size: 1.2em;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>å®æ¢ã—ã‚²ãƒ¼ãƒ </h1>
  <div id="message">ã‚ãªãŸã®ç•ªã§ã™ï¼</div>
  <div id="grid"></div>

  <script>
    const grid = document.getElementById("grid");
    const message = document.getElementById("message");

    const SIZE = 10;
    const TREASURE_COUNT = 3;
    let playerFound = 0;
    let cpuFound = 0;
    let treasures = [];
    let isPlayerTurn = true;
    let cells = [];

    // åˆæœŸåŒ–
    function init() {
      // ã‚°ãƒªãƒƒãƒ‰ç”Ÿæˆ
      for (let i = 0; i < SIZE * SIZE; i++) {
        const cell = document.createElement("div");
        cell.classList.add("cell");
        cell.dataset.index = i;
        cell.addEventListener("click", () => handlePlayerTurn(i));
        grid.appendChild(cell);
        cells.push(cell);
      }

      // ãŠå®ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é…ç½®
      while (treasures.length < TREASURE_COUNT) {
        const rand = Math.floor(Math.random() * SIZE * SIZE);
        if (!treasures.includes(rand)) treasures.push(rand);
      }
    }

    function handlePlayerTurn(index) {
      if (!isPlayerTurn) return;

      const cell = cells[index];
      if (cell.classList.contains("player") || cell.classList.contains("cpu")) return;

      cell.classList.add("player");
      checkTreasure(index, "player");

      isPlayerTurn = false;
      setTimeout(cpuTurn, 2000);
    }

    function cpuTurn() {
      message.textContent = "CPUã®ç•ªã§ã™...";

      // é¸ã‚“ã§ãªã„ãƒã‚¹ã‚’å–å¾—
      const available = cells
        .map((cell, i) => ({cell, index: i}))
        .filter(({cell}) => !cell.classList.contains("player") && !cell.classList.contains("cpu"));

      if (available.length === 0) return;

      // æ”»ã‚å§¿å‹¢ã§ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠ
      const {index} = available[Math.floor(Math.random() * available.length)];
      const cell = cells[index];
      cell.classList.add("cpu");
      checkTreasure(index, "cpu");

      setTimeout(() => {
        isPlayerTurn = true;
        message.textContent = "ã‚ãªãŸã®ç•ªã§ã™ï¼";
      }, 2000);
    }

    function checkTreasure(index, player) {
      if (treasures.includes(index)) {
        if (player === "player") {
          playerFound++;
          message.textContent = `ãŠå®ç™ºè¦‹ï¼ ã‚ãªãŸ: ${playerFound} / 3`;
          if (playerFound === TREASURE_COUNT) {
            endGame("ğŸ‰ ã‚ãªãŸã®å‹ã¡ï¼");
          }
        } else {
          cpuFound++;
          message.textContent = `CPUãŒå®ã‚’è¦‹ã¤ã‘ãŸï¼ CPU: ${cpuFound} / 3`;
          if (cpuFound === TREASURE_COUNT) {
            endGame("ğŸ˜ˆ CPUã®å‹ã¡ï¼");
          }
        }
      }
    }

    function endGame(result) {
      message.textContent = result;
      cells.forEach(cell => cell.classList.add("disabled"));
    }

    init();
  </script>
</body>
</html>
