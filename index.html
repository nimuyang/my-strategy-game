<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ストラテジーゲーム</title>
  <style>
    table { border-collapse: collapse; margin-top: 20px; }
    td {
      width: 40px; height: 40px; border: 1px solid #333;
      text-align: center; vertical-align: middle; font-size: 18px;
      cursor: pointer;
    }
    .player { background-color: lightblue; }
    .nike { background-color: lightcoral; }
    #info { position: absolute; top: 10px; right: 10px; text-align: right; }
    #result { margin-top: 20px; font-weight: bold; }
  </style>
</head>
<body>
  <div id="info">
    <div>ターン数: <span id="turn">1</span></div>
    <div>あなたの獲得マス: <span id="playerScore">0</span></div>
  </div>

  <table id="board"></table>

  <div id="result"></div>

  <script>
    const boardSize = 5;
    const board = document.getElementById("board");
    const turnDisplay = document.getElementById("turn");
    const playerScoreDisplay = document.getElementById("playerScore");
    const resultDisplay = document.getElementById("result");

    let turnCount = 1;
    let playerScore = 0;
    let nikeScore = 0;
    let totalMoves = 0;
    let currentPlayer = "player"; // "player" or "nike"
    let timer;

    function updateScores() {
      playerScoreDisplay.textContent = playerScore;
    }

    function endGame() {
      let winner;
      if (playerScore > nikeScore) winner = "あなた";
      else if (nikeScore > playerScore) winner = "nike";
      else winner = "引き分け";

      resultDisplay.innerHTML = `ゲーム終了！<br>あなた: ${playerScore} マス<br>nike: ${nikeScore} マス<br><strong>勝者: ${winner}</strong>`;
    }

    function checkGameOver() {
      if (totalMoves >= boardSize * boardSize) {
        clearTimeout(timer);
        endGame();
        return true;
      }
      return false;
    }

    function switchTurn() {
      clearTimeout(timer);
      currentPlayer = currentPlayer === "player" ? "nike" : "player";
      turnCount++;
      turnDisplay.textContent = turnCount;

      if (!checkGameOver()) {
        if (currentPlayer === "nike") {
          setTimeout(nikeTurn, 500);
        } else {
          startTimer();
        }
      }
    }

    function startTimer() {
      timer = setTimeout(() => {
        switchTurn();
      }, 10000); // 10秒
    }

    function nikeTurn() {
      const cells = Array.from(document.querySelectorAll("td"));
      const emptyCells = cells.filter(c => c.textContent === "");
      if (emptyCells.length === 0) return;
      const cell = emptyCells[Math.floor(Math.random() * emptyCells.length)];
      cell.textContent = "N";
      cell.classList.add("nike");
      nikeScore++;
      totalMoves++;
      checkGameOver() || switchTurn();
    }

    function handleClick(e) {
      const cell = e.target;
      if (currentPlayer !== "player" || cell.textContent !== "") return;

      cell.textContent = "P";
      cell.classList.add("player");
      playerScore++;
      totalMoves++;
      updateScores();
      checkGameOver() || switchTurn();
    }

    function createBoard() {
      for (let i = 0; i < boardSize; i++) {
        const row = document.createElement("tr");
        for (let j = 0; j < boardSize; j++) {
          const cell = document.createElement("td");
          cell.addEventListener("click", handleClick);
          row.appendChild(cell);
        }
        board.appendChild(row);
      }
    }

    createBoard();
    startTimer();
  </script>
</body>
</html>
