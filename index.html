<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>宝探しストラテジーゲーム</title>
  <style>
    body {
      font-family: sans-serif;
      background: #222;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    #grid {
      display: grid;
      grid-template-columns: repeat(10, 40px);
      grid-gap: 5px;
      margin-bottom: 20px;
    }
    .cell {
      width: 40px;
      height: 40px;
      background: #444;
      border: 1px solid #666;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 18px;
    }
    .player {
      background: blue !important;
    }
    .cpu {
      background: red !important;
    }
    .treasure {
      background: yellow !important;
      color: black !important;
      pointer-events: none;
    }
    .disabled {
      pointer-events: none;
    }
    #message {
      font-size: 1.2em;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>宝探しゲーム</h1>
  <div id="message">あなたの番です！</div>
  <div id="grid"></div>

  <script>
    const grid = document.getElementById("grid");
    const message = document.getElementById("message");

    const SIZE = 5;
    const TREASURE_COUNT = 3;
    let playerFound = 0;
    let cpuFound = 0;
    let treasures = [];
    let isPlayerTurn = true;
    let cells = [];

    // 初期化
    function init() {
      for (let i = 0; i < SIZE * SIZE; i++) {
        const cell = document.createElement("div");
        cell.classList.add("cell");
        cell.dataset.index = i;
        cell.addEventListener("click", () => handlePlayerTurn(i));
        grid.appendChild(cell);
        cells.push(cell);
      }

      // お宝ランダム配置
      while (treasures.length < TREASURE_COUNT) {
        const rand = Math.floor(Math.random() * SIZE * SIZE);
        if (!treasures.includes(rand)) treasures.push(rand);
      }
    }

    function handlePlayerTurn(index) {
      if (!isPlayerTurn) return;

      const cell = cells[index];
      if (cell.classList.contains("player") || cell.classList.contains("cpu") || cell.classList.contains("treasure")) return;

      if (treasures.includes(index)) {
        cell.classList.add("treasure");
        cell.textContent = "P";
        playerFound++;
        message.textContent = `お宝発見！ あなた: ${playerFound} / 3`;
        if (playerFound === TREASURE_COUNT) {
          endGame("🎉 あなたの勝ち！");
          return;
        }
      } else {
        cell.classList.add("player");
      }

      isPlayerTurn = false;
      setTimeout(cpuTurn, 2000);
    }

    function cpuTurn() {
      message.textContent = "CPUの番です...";

      const available = cells
        .map((cell, i) => ({cell, index: i}))
        .filter(({cell}) =>
          !cell.classList.contains("player") &&
          !cell.classList.contains("cpu") &&
          !cell.classList.contains("treasure")
        );

      if (available.length === 0) return;

      const {index, cell} = available[Math.floor(Math.random() * available.length)];

      if (treasures.includes(index)) {
        cell.classList.add("treasure");
        cell.textContent = "N";
        cpuFound++;
        message.textContent = `CPUが宝を見つけた！ CPU: ${cpuFound} / 3`;
        if (cpuFound === TREASURE_COUNT) {
          endGame("😈 CPUの勝ち！");
          return;
        }
      } else {
        cell.classList.add("cpu");
      }

      setTimeout(() => {
        isPlayerTurn = true;
        message.textContent = "あなたの番です！";
      }, 2000);
    }

    function endGame(result) {
      message.textContent = result;
      cells.forEach(cell => cell.classList.add("disabled"));
    }

    init();
  </script>
</body>
</html>
