<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ストラテジーゲーム</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      font-size: 115%;
    }
    #game-container {
      position: relative;
    }
    table {
      border-collapse: collapse;
      margin-top: 20px;
      margin-left: auto;
      margin-right: auto;
    }
    td {
      width: 46px; height: 46px; border: 1px solid #333;
      text-align: center; vertical-align: middle; font-size: 20px;
      cursor: pointer;
    }
    .player { background-color: lightblue; }
    .nike { background-color: lightcoral; }
    #info {
      position: absolute;
      top: -60px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
    }
    #timer {
      position: absolute;
      top: 0;
      right: -150px;
      font-weight: bold;
    }
    #result { margin-top: 20px; font-weight: bold; text-align: center; }
  </style>
</head>
<body>
  <div id="game-container">
    <div id="info">
      <div>ターン数: <span id="turn">1</span></div>
      <div>あなたの獲得マス: <span id="playerScore">0</span></div>
    </div>
    <div id="timer">残り時間: <span id="timeLeft">10</span>秒</div>
    <table id="board"></table>
    <div id="result"></div>
  </div>

  <script>
    const boardSize = 5;
    const board = document.getElementById("board");
    const turnDisplay = document.getElementById("turn");
    const playerScoreDisplay = document.getElementById("playerScore");
    const resultDisplay = document.getElementById("result");
    const timeLeftDisplay = document.getElementById("timeLeft");

    let turnCount = 1;
    let playerScore = 0;
    let nikeScore = 0;
    let totalMoves = 0;
    let currentPlayer = "player"; // "player" or "nike"
    let timer;
    let timeLeft = 10;
    let countdown;

    function updateScores() {
      playerScoreDisplay.textContent = playerScore;
    }

    function endGame() {
      let winner;
      if (playerScore > nikeScore) winner = "あなた";
      else if (nikeScore > playerScore) winner = "nike";
      else winner = "引き分け";

      resultDisplay.innerHTML = `ゲーム終了！<br>あなた: ${playerScore} マス<br>nike: ${nikeScore} マス<br><strong>勝者: ${winner}</strong>`;
    }

    function checkGameOver() {
      if (totalMoves >= boardSize * boardSize) {
        clearTimeout(timer);
        clearInterval(countdown);
        endGame();
        return true;
      }
      return false;
    }

    function updateTimerDisplay() {
      timeLeftDisplay.textContent = timeLeft;
    }

    function switchTurn() {
      clearTimeout(timer);
      clearInterval(countdown);
      currentPlayer = currentPlayer === "player" ? "nike" : "player";
      turnCount++;
      turnDisplay.textContent = turnCount;

      if (!checkGameOver()) {
        if (currentPlayer === "nike") {
          setTimeout(nikeTurn, 500);
        } else {
          startTimer();
        }
      }
    }

    function startTimer() {
      timeLeft = 10;
      updateTimerDisplay();
      countdown = setInterval(() => {
        timeLeft--;
        updateTimerDisplay();
        if (timeLeft <= 0) {
          clearInterval(countdown);
        }
      }, 1000);
      timer = setTimeout(() => {
        switchTurn();
      }, 10000);
    }

    function nikeTurn() {
      const cells = Array.from(document.querySelectorAll("td"));
      const emptyCells = cells.filter(c => c.textContent === "");
      if (emptyCells.length === 0) return;
      const cell = emptyCells[Math.floor(Math.random() * emptyCells.length)];
      cell.textContent = "N";
      cell.classList.add("nike");
      nikeScore++;
      totalMoves++;
      checkGameOver() || switchTurn();
    }

    function handleClick(e) {
      const cell = e.target;
      if (currentPlayer !== "player" || cell.textContent !== "") return;

      cell.textContent = "P";
      cell.classList.add("player");
      playerScore++;
      totalMoves++;
      updateScores();
      checkGameOver() || switchTurn();
    }

    function createBoard() {
      for (let i = 0; i < boardSize; i++) {
        const row = document.createElement("tr");
        for (let j = 0; j < boardSize; j++) {
          const cell = document.createElement("td");
          cell.addEventListener("click", handleClick);
          row.appendChild(cell);
        }
        board.appendChild(row);
      }
    }

    createBoard();
    startTimer();
  </script>
</body>
</html>
